{
  username,
  inputs,
  ...
}: let
  homeManagerSessionVars = "/etc/profiles/per-user/$USER/etc/profile.d/hm-session-vars.sh";
in {
  imports = [
    inputs.home-manager.nixosModules.home-manager
  ];

  # import home-manager env vars
  environment.extraInit = "[[ -f ${homeManagerSessionVars} ]] && source ${homeManagerSessionVars}";

  home-manager = {
    extraSpecialArgs = {
      inherit inputs;
      inherit username;
    };
    useGlobalPkgs = true;
    useUserPackages = true;
    backupFileExtension = "hm-backup";
  };
}
